name: Bump, Publish, and Release

on:
  workflow_dispatch:
    branches:
      - main
    inputs:
      newversion:
        description: "Bump Type (major minor patch)"
        required: true
        default: "patch"
        type: choice
        options:
          - patch
          - minor
          - major
      testpublish:
        description: "Publish to TestPypi"
        default: false
        type: boolean

jobs:
  publish:
    uses: prosegrinder/.github/.github/workflows/python-poetry-publish.yaml@main
    with:
      newversion: ${{ github.event.inputs.newversion }}
      testpublish: ${{ 'true' == github.event.inputs.testpublish }}
    secrets:
      TEST_PYPI_API_TOKEN: ${{ secrets.TEST_PYPI_API_TOKEN }}
      PYPI_API_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
      VERSION_BUMP_TAG_TOKEN: ${{ secrets.VERSION_BUMP_TAG_TOKEN }}
